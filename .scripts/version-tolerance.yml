jobs:
  - job: VersionToleranceTests
    steps:
      - template: build.yml

      - script: npm run validate-version-tolerance
        displayName: "Run Version Tolerance Validation"

      - script: npm run check:tree
        displayName: "Check git Tree"

      - script: |
          npm run coverage -- $(Build.Repository.Name) $(Build.SourceBranch) $(github-token) $(storage-coverage-user) $(storage-coverage-pass)
        workingDirectory: node_modules/@microsoft.azure/autorest.testserver
        displayName: "Upload Coverage Report"
        condition: and(ne(variables['Build.Reason'], 'PullRequest'), eq(variables['System.TeamProject'], 'internal'))
